<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <link rel="icon" href="icon-page.png" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SIGACC - Sistema Integrado de Gestão de Atividades Complementares Curriculares</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/downloadjs@1.4.7"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/downloadjs@1.4.7"></script>

    <link rel="stylesheet" href="style.css">
    <script src="script.js"></script>

    <!--
    <link rel="stylesheet" href="style-teste.css">
    <script src="script-teste.js"></script>
    -->
</head>

<body>
    <div class="bg-decoration">
        <div class="circle circle-1"></div>
        <div class="circle circle-2"></div>
        <div class="circle circle-3"></div>
    </div>
    <div class="login-container" id="loginScreen">
        <div class="login-header">
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
            </div>
            <h2 id="loginTitle">Login</h2>
            <p>Acesse suas atividades complementares</p>
        </div>
        <div id="errorMessage" class="message error-message">
            <i class="fas fa-exclamation-circle"></i>
            <span>Usuário ou senha inválidos!</span>
        </div>
        <div id="successMessage" class="message success-message">
            <i class="fas fa-check-circle"></i>
            <span>Registro realizado com sucesso!</span>
        </div>
        <form id="loginForm">
            <div class="form-group">
                <label for="username">Usuário</label>
                <i class="fas fa-user input-icon"></i>
                <input type="text" id="username" placeholder="Digite seu usuário" required>
            </div>

            <!-- Campos de registro (inicialmente ocultos) -->
            <div id="registrationFields" class="registration-fields">
                <div class="form-group">
                    <label for="nomeCompleto">Nome Completo</label>
                    <i class="fas fa-user-circle input-icon"></i>
                    <input type="text" id="nomeCompleto" placeholder="Digite seu nome completo">
                </div>
                <div class="form-group">
                    <label for="matricula">Matrícula</label>
                    <i class="fas fa-id-card input-icon"></i>
                    <input type="text" id="matricula" placeholder="Digite sua matrícula (11 dígitos)" maxlength="11">
                </div>
            </div>

            <div class="form-group">
                <label for="password">Senha</label>
                <i class="fas fa-lock input-icon"></i>
                <input type="password" id="password" placeholder="Digite sua senha" required>
                <i class="fas fa-eye password-toggle" id="togglePassword"></i>
            </div>
            <button type="submit" class="login-btn" id="submitBtn">Entrar</button>
        </form>
        <div class="divider">
            <span>ou</span>
        </div>
        <div class="login-links">
            <a href="#" class="link-item" id="toggleLink">
                <i class="fas fa-user-plus"></i> Não tem conta? Registre-se
            </a>
            <a href="#" class="link-item" id="aboutLink">
                <i class="fas fa-info-circle"></i> Sobre o sistema
            </a>
            <a href="https://www.engproducao.uema.br/wp-content/uploads/2021/09/RESOLU%C3%87%C3%83O-DE-ATIVIDADES-COMPLEMENTARES-2021.pdf"
                class="link-item" target="_blank">
                <i class="fas fa-file-pdf"></i> Resolução de Atividades Complementares
            </a>
        </div>
        <div class="login-footer">
            <p>SIGACC - Desenvolvido por Diego Bezerra Reinaldo © 2025</p>
        </div>
    </div>

    <div id="mainScreen">
        <div class="main-header">
            <div class="user-info">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-details">
                    <h2 id="userName">Carregando...</h2>
                    <p id="userCourse">Engenharia de Produção Bacharelado UEMA</p>
                </div>
            </div>

            <div class="header-buttons">
                <button class="header-btn" type="button" id="exportBtn">
                    <i class="fas fa-file-export"></i> Exportar
                </button>
                <button class="header-btn" type="button" id="importBtn">
                    <i class="fas fa-file-import"></i> Importar
                </button>
                <button class="header-btn logout" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </button>
            </div>

        </div>

        <div class="tabs-container">
            <div class="tabs" id="tabsContainer">
                <div class="tab active" data-tab="cadastrar">Cadastrar Atividade</div>
                <div class="tab" data-tab="exibir">Minhas Atividades</div>
                <div class="tab" data-tab="editar">Editar Atividade</div>
                <div class="tab" data-tab="resumo">Resumo</div>
            </div>
        </div>

        <div class="tab-content active" id="cadastrar">
            <div class="form-container">
                <h3 class="form-title"><i class="fas fa-plus-circle"></i> Nova Atividade Complementar</h3>

                <form id="formCadastro">
                    <div class="form-grid">
                        <div class="form-group-main">
                            <label for="nome">Descrição da Atividade</label>
                            <input type="text" id="nome" placeholder="Ex: Participação em congresso" required>

                            <!--<div class="info-tooltip">
                                Descreva a atividade de forma que seja possivel identificá-la, pois será essa informação
                                que será exibida na tabela do relatório. Ex.: "Participação na maratona Excel para
                                Gestão e Controle do Iniciante ao Avançado"
                            </div>-->
                        </div>

                        <div class="form-group-main">
                            <label for="tipo">Tipo de Atividade</label>
                            <select id="tipo" required>
                                <!-- As opções serão preenchidas por JavaScript -->
                            </select>
                        </div>

                        <div class="form-group-main">
                            <label for="horas">Horas Registradas</label>
                            <div class="input-container">
                                <input type="number" id="horas" placeholder="Ex: 100" min="0" step="0.1" required>
                                <i class="fas fa-info-circle info-icon"></i>
                                <div class="info-tooltip">
                                    Quantidade total de horas que você dedicou a esta atividade
                                </div>
                            </div>
                        </div>

                        <div class="form-group-main">
                            <label for="periodo">Período</label>
                            <input type="text" id="periodo" placeholder="Ex: 2023.1" required>
                        </div>

                        <div class="form-group-main">
                            <label for="comprovante">Comprovante (PDF)</label>
                            <input type="file" id="comprovante" accept=".pdf">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="form-btn primary">
                            <i class="fas fa-save"></i> Salvar Atividade
                        </button>
                        <button type="button" class="form-btn secondary" id="limparCadastroBtn">
                            <i class="fas fa-times"></i> Limpar
                        </button>
                    </div>
                </form>
            </div>

            <div class="system-message info">
                <i class="fas fa-info-circle"></i>
                <span>Preencha todos os campos para cadastrar uma nova atividade complementar.</span>
            </div>
        </div>

        <div class="tab-content" id="exibir">
            <div class="form-container">
                <h3 class="form-title"><i class="fas fa-filter"></i> Filtros</h3>
                <form id="formFiltro">
                    <div class="form-grid">
                        <!--<div class="filters-connected">-->
                        <div class="form-group-main">
                            <label for="filtroGrupo">Grupo de Atividade</label>
                            <select id="filtroGrupo">
                                <!-- As opções serão preenchidas por JavaScript -->
                            </select>
                        </div>

                        <div class="form-group-main">
                            <label for="filtroTipo">Tipo de Atividade</label>
                            <select id="filtroTipo">
                                <!-- As opções serão preenchidas por JavaScript -->
                            </select>
                        </div>

                        <div class="form-group-main">
                            <label for="filtroPeriodo">Período</label>
                            <input type="text" id="filtroPeriodo" placeholder="Ex: 2023.1">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="form-btn primary">
                            <i class="fas fa-search"></i> Aplicar Filtros
                        </button>
                        <button type="button" class="form-btn secondary" id="limparFiltrosBtn">
                            <i class="fas fa-redo"></i> Limpar Filtros
                        </button>
                        <button type="button" class="form-btn primary" id="imprimirBtn">
                            <i class="fas fa-print"></i> Gerar Relaltório
                        </button>
                    </div>
                    <!-- Modal de Preview do Relatório -->
                    <div id="previewRelatorioOverlay" class="modal-overlay" style="display: none;">
                        <div class="modal-content-preview">
                            <div class="modal-header">
                                <h2>Visualização do Relatório</h2>
                                <span class="btn-close" onclick="fecharPreviewRelatorio()">×</span>
                            </div>
                            <div class="modal-body">
                                <iframe id="previewRelatorioIframe" width="100%" height="800px"></iframe>
                            </div>
                            <div class="modal-footer">
                                <button class="form-btn secondary" onclick="fecharPreviewRelatorio()">Fechar</button>
                                <button class="form-btn primary" onclick="baixarPdfAtual()">Baixar Relatório</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div class="table-container">
                <table class="activities-table" id="activitiesTable">
                    <!-- Colgroup permite controle direto das larguras das colunas -->
                    <colgroup>
                        <col style="width:400px">
                        <col style="width:375px">
                        <col style="width:100px">
                        <col style="width:100px">
                        <col style="width:100px">
                        <col style="width:125px">
                        <col style="width:100px">
                        <col style="width:100px">
                    </colgroup>

                    <thead>
                        <tr>
                            <th>Nome<div class="resizer" data-col="0"></div>
                            </th>
                            <th>Tipo<div class="resizer" data-col="1"></div>
                            </th>
                            <th>Horas Registradas<div class="resizer" data-col="2"></div>
                            </th>
                            <th>Horas Validadas<div class="resizer" data-col="3"></div>
                            </th>
                            <th>Período<div class="resizer" data-col="4"></div>
                            </th>
                            <th>Status<div class="resizer" data-col="5"></div>
                            </th>
                            <th>Comprovante<div class="resizer" data-col="6"></div>
                            </th>
                            <th>Ações<div class="resizer" data-col="7"></div>
                            </th>
                        </tr>
                    </thead>

                    <tbody id="tabelaAtividades">
                        <!-- preenchido por JS -->
                    </tbody>
                </table>
            </div>

            <div class="hours-summary">
                <div class="summary-item">
                    <div class="summary-value" id="totalHorasRegistradas">0</div>
                    <div class="summary-label">Horas Registradas</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value" id="totalHorasValidadas">0</div>
                    <div class="summary-label">Horas Validadas</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value">225</div>
                    <div class="summary-label">Horas Necessárias</div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="editar">
            <div class="form-container">
                <h3 class="form-title"><i class="fas fa-edit"></i> Editar Atividade</h3>

                <form id="formEdicao">
                    <input type="hidden" id="idEdicao">
                    <div class="form-grid">
                        <div class="form-group-main">
                            <label for="nomeEdicao">Descrição da Atividade</label>
                            <input type="text" id="nomeEdicao" required>
                        </div>

                        <div class="form-group-main">
                            <label for="tipoEdicao">Tipo de Atividade</label>
                            <select id="tipoEdicao" required>
                            </select>
                        </div>

                        <div class="form-group-main">
                            <label for="horasEdicao">Horas Registradas</label>
                            <input type="number" id="horasEdicao" min="0" step="0.1" required>
                        </div>

                        <div class="form-group-main">
                            <label for="periodoEdicao">Período</label>
                            <input type="text" id="periodoEdicao" required>
                        </div>

                        <div class="form-group-main">
                            <label for="comprovanteEdicao">Comprovante (PDF)</label>
                            <input type="file" id="comprovanteEdicao" accept=".pdf">
                            <div id="comprovanteAtualInfo" class="file-info"></div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="form-btn primary" id="submitEdicaoBtn">
                            <i class="fas fa-save"></i> Salvar Alterações
                        </button>
                        <button type="button" class="form-btn secondary" id="cancelarEdicaoBtn">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </form>
            </div>

            <div class="system-message info">
                <i class="fas fa-info-circle"></i>
                <span>Selecione uma atividade na aba "Minhas Atividades" para editar.</span>
            </div>
        </div>

        <div class="tab-content" id="resumo">
            <div class="form-container">
                <h3 class="form-title"><i class="fas fa-chart-pie"></i> Resumo de Horas</h3>

                <div class="chart-container" style="height: 300px; position: relative;">
                    <canvas id="hoursChart"></canvas>
                </div>
            </div>

            <div class="hours-summary">
                <div class="summary-item">
                    <div class="summary-value" id="resumoHorasRegistradas">0</div>
                    <div class="summary-label">Horas Registradas</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value" id="resumoHorasValidadas">0</div>
                    <div class="summary-label">Horas Validadas</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value">225</div>
                    <div class="summary-label">Horas Necessárias</div>
                </div>
            </div>

            <div class="form-container">
                <h3 class="form-title"><i class="fas fa-tasks"></i> Progresso</h3>

                <div class="progress-container">
                    <div class="progress-label">
                        <span>Progresso total</span>
                        <span id="progressoTotalPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressoTotalFill"
                            style="width: 0%; height: 100%; background: linear-gradient(to right, var(--orange), var(--dark-orange));">
                        </div>
                    </div>
                </div>

                <div class="progress-container">
                    <div class="progress-label">
                        <span>Horas validadas</span>
                        <span id="horasValidadasPercent">0/225</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="horasValidadasFill"
                            style="width: 0%; height: 100%; background: linear-gradient(to right, #28a745, #218838);">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Área de administração (mantida no HTML mas oculta) -->
        <div class="tab-content" id="desenvolvedor">
            <div class="form-container">
                <h3 class="form-title"><i class="fas fa-cogs"></i> Administração</h3>

                <div class="system-message info">
                    <i class="fas fa-info-circle"></i>
                    <span>Esta área é restrita aos administradores do sistema.</span>
                </div>

                <div class="form-container">
                    <h4><i class="fas fa-users"></i> Gerenciar Usuários</h4>

                    <div class="form-group-main">
                        <label for="filtroUsuario">Buscar Usuário</label>
                        <div class="form-inline" style="display: flex; gap: 10px;">
                            <input type="text" id="filtroUsuario" placeholder="Digite o nome de usuário"
                                style="flex: 1;">
                            <button class="form-btn primary" id="buscarUsuarioBtn">
                                <i class="fas fa-search"></i> Buscar
                            </button>
                        </div>
                    </div>

                    <div id="detalhesUsuario" class="hidden" style="margin-top: 20px;">
                        <h5>Detalhes do Usuário</h5>
                        <div class="form-grid">
                            <div class="form-group-main">
                                <label for="adminUsername">Usuário</label>
                                <input type="text" id="adminUsername" readonly>
                            </div>
                            <div class="form-group-main">
                                <label for="adminPassword">Nova Senha</label>
                                <input type="password" id="adminPassword" placeholder="Deixe em branco para manter">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="form-btn primary" id="salvarUsuarioBtn">
                                <i class="fas fa-save"></i> Salvar Alterações
                            </button>
                            <button type="button" class="form-btn danger" id="resetarUsuarioBtn">
                                <i class="fas fa-trash"></i> Resetar Atividades
                            </button>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===========================
     JS: resizer (cole no final do body ou em um arquivo .js)
     =========================== -->
    <script>
        (function () {
            const table = document.getElementById('activitiesTable');
            if (!table) return;

            const colgroup = table.querySelectorAll('col');
            const ths = table.querySelectorAll('thead th');
            const container = table.closest('.table-container');

            // Função utilitária para obter valor numérico de uma largura CSS (px)
            function pxToNumber(px) {
                return px ? parseFloat(px.replace('px', '')) : 0;
            }

            // Adiciona listeners aos resizers já presentes no DOM (criamos eles no HTML)
            const resizers = table.querySelectorAll('.resizer');

            resizers.forEach(resizer => {
                const colIndex = Number(resizer.dataset.col);
                let startX, startWidth;

                const minWidth = 60; // px mínimo absoluto (ajuste se quiser)

                const mouseDown = function (e) {
                    e.preventDefault();
                    startX = e.clientX || (e.touches && e.touches[0].clientX);
                    // largura atual da coluna (colgroup)
                    startWidth = colgroup[colIndex].getBoundingClientRect().width;

                    // evitar seleção de texto durante o drag
                    document.body.style.userSelect = 'none';
                    document.body.style.cursor = 'col-resize';

                    document.addEventListener('mousemove', mouseMove);
                    document.addEventListener('mouseup', mouseUp);
                    // suporte touch
                    document.addEventListener('touchmove', mouseMove, { passive: false });
                    document.addEventListener('touchend', mouseUp);
                };

                const mouseMove = function (e) {
                    e.preventDefault();
                    const clientX = e.clientX || (e.touches && e.touches[0].clientX);
                    const dx = clientX - startX;
                    let newWidth = Math.max(minWidth, startWidth + dx);

                    // aplica largura em px diretamente no <col> correspondente
                    colgroup[colIndex].style.width = newWidth + 'px';

                    // se quiser manter o cabeçalho bonito: também atualiza o th correspondente
                    if (ths[colIndex]) ths[colIndex].style.width = newWidth + 'px';
                };

                const mouseUp = function () {
                    document.removeEventListener('mousemove', mouseMove);
                    document.removeEventListener('mouseup', mouseUp);
                    document.removeEventListener('touchmove', mouseMove);
                    document.removeEventListener('touchend', mouseUp);

                    document.body.style.userSelect = '';
                    document.body.style.cursor = '';

                    // opcional: guardar larguras no localStorage para persistir entre reloads
                    // salvarLarguras();
                };

                resizer.addEventListener('mousedown', mouseDown);
                resizer.addEventListener('touchstart', mouseDown, { passive: false });
            });

            // ---- (opcional) persistência: recuperar larguras salvas (se quiser)
            // Você pode habilitar este recurso comentando as linhas abaixo.
            function carregarLarguras() {
                try {
                    const raw = localStorage.getItem('activitiesTableColWidths');
                    if (!raw) return;
                    const arr = JSON.parse(raw);
                    arr.forEach((w, i) => {
                        if (colgroup[i] && w) colgroup[i].style.width = w;
                    });
                } catch (e) { /* ignore */ }
            }
            function salvarLarguras() {
                const arr = Array.from(colgroup).map(c => c.style.width || window.getComputedStyle(c).width);
                localStorage.setItem('activitiesTableColWidths', JSON.stringify(arr));
            }
        })();
    </script>
</body>

</html>